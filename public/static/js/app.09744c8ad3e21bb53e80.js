webpackJsonp([1],{0:function(t,o){},1:function(t,o){},"4g1k":function(t,o){},NHnr:function(t,o,e){"use strict";function r(t){e("4g1k")}function n(t){e("Tk4b")}Object.defineProperty(o,"__esModule",{value:!0});var a=e("7+uW"),s={name:"app",methods:{logout:function(){var t=this;a.default.http.get("/auth/logout").then(function(o){"logout success!"===o.body?(localStorage.removeItem("userid"),localStorage.removeItem("current_room"),localStorage.removeItem("joined_rooms"),t.$router.replace("/")):console.log("logout failed!")})}}},l=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("div",{attrs:{id:"app"}},[e("el-menu",{attrs:{mode:"horizontal","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"}},[e("el-menu-item",{attrs:{index:"1"},on:{click:t.logout}},[t._v("Log Out")])],1),t._v(" "),e("router-view")],1)},m=[],c={render:l,staticRenderFns:m},i=c,u=e("VU/8"),d=u(s,i,!1,null,null,null),f=d.exports,p=e("ORbq"),_=e("/ocq"),g={data:function(){return{status:"",form:{username:"",password:""}}},methods:{onSubmit:function(){var t=this;a.default.http.post("/auth/login",{username:this.form.username,password:this.form.password}).then(function(o){"login success"===o.body?(t.status="login success",localStorage.setItem("userid",t.form.username),t.$router.replace("/rooms")):t.status=o.body})}}},v=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("el-row",{staticStyle:{"margin-top":"7%"}},[e("el-col",{attrs:{span:8,offset:7}},[e("el-form",{ref:"form",attrs:{model:t.form,"label-width":"120px"}},[e("el-form-item",{attrs:{label:"username"}},[e("el-input",{model:{value:t.form.username,callback:function(o){t.$set(t.form,"username",o)},expression:"form.username"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"password"}},[e("el-input",{model:{value:t.form.password,callback:function(o){t.$set(t.form,"password",o)},expression:"form.password"}})],1),t._v(" "),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("Login")]),t._v(" "),e("el-button",[t._v("Cancel")])],1),t._v(" "),e("div",[t._v(t._s(t.status))])],1)],1)],1)},h=[],b={render:v,staticRenderFns:h},y=b,S=e("VU/8"),w=S(g,y,!1,null,null,null),I=w.exports,k=e("DmT9"),x=e.n(k),R={data:function(){return{socket:x()({query:{u:localStorage.getItem("userid"),r:localStorage.getItem("current_room")}}),current_room:localStorage.getItem("current_room"),msgs:[],temp_msg:""}},created:function(){var t=this;this.socket.on("chat",function(o){t.msgs.push(o)})},methods:{send:function(t){this.socket.emit("chat",t),this.temp_msg=""},tableRowClassName:function(t){var o=t.row;t.rowIndex;return o.who===localStorage.getItem("userid")?"your-word":""},goRooms:function(){this.socket.close(),this.$router.replace("/rooms")}}},j=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("div",[e("el-row",[e("el-col",{attrs:{span:22}},[e("h4",{staticStyle:{"text-align":"left"}},[e("i",{staticClass:"el-icon-star-on"}),t._v(" "+t._s(t.current_room)+" "),e("i",{staticClass:"el-icon-star-on"})])]),t._v(" "),e("el-col",{attrs:{span:2}},[e("el-button",{attrs:{type:"success",round:""},on:{click:t.goRooms}},[t._v("Go Back")])],1)],1),t._v(" "),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.msgs,"row-class-name":t.tableRowClassName}},[e("el-table-column",{attrs:{prop:"who",width:"180"}}),t._v(" "),e("el-table-column",{attrs:{prop:"msg"}})],1),t._v(" "),e("el-row",{attrs:{gutter:20}},[e("form",{ref:"form",attrs:{id:"fix-form"},on:{submit:function(o){o.preventDefault(),t.send(t.temp_msg)}}},[e("el-col",{attrs:{span:22}},[e("el-input",{model:{value:t.temp_msg,callback:function(o){t.temp_msg=o},expression:"temp_msg"}})],1),t._v(" "),e("el-col",{attrs:{span:2}},[e("el-button",{attrs:{round:""},on:{click:function(o){t.send(t.temp_msg)}}},[t._v("Send")])],1)],1)])],1)},$=[],C={render:j,staticRenderFns:$},E=C,O=e("VU/8"),U=r,q=O(R,E,!1,U,"data-v-0c01dc48",null),F=q.exports,L={data:function(){return{my_rooms:[],all_rooms:[],new_room_name:"",status:""}},mounted:function(){var t=this;localStorage.removeItem("current_room"),a.default.http.get("/v1/user/"+localStorage.getItem("userid")).then(function(o){o.data&&(t.my_rooms=o.data.join_rooms,t.all_rooms=o.data.allrooms.map(function(t){return t._id}),localStorage.setItem("joined_rooms",t.my_rooms))}).catch(function(o){localStorage.getItem("joined_rooms")&&(t.my_rooms=localStorage.getItem("joined_rooms"),console.log("load local"))})},methods:{enter:function(t){localStorage.setItem("current_room",t),this.$router.replace("/chat")},leave:function(t){var o=this;a.default.http.post("/v1/room",{action:"leave",roomid:t,userid:localStorage.getItem("userid")}).then(function(e){if(e.body.roomid){var r=o.all_rooms.indexOf(t);o.all_rooms.splice(r,1),"room deleted"===e.body.roomid&&(r=o.my_rooms.indexOf(t),o.all_rooms.splice(r,1)),localStorage.getItem("current_room")===t&&localStorage.removeItem("current_room")}else o.status="leave room failed"})},join:function(t){var o=this;a.default.http.post("/v1/room",{action:"enter",roomid:t,userid:localStorage.getItem("userid")}).then(function(t){t.body.roomid?(o.my_rooms.push(t.body.roomid),localStorage.setItem("joined_rooms",o.my_rooms)):o.status="join new room failed"})},onSubmit:function(){var t=this;a.default.http.post("/v1/room",{action:"enter",roomid:null,userid:localStorage.getItem("userid")}).then(function(o){o.body.roomid?(t.my_rooms.push(o.body.roomid),t.all_rooms.push(o.body.roomid),localStorage.setItem("joined_rooms",t.my_rooms)):t.status="enter new room failed"})}}},N=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("el-container",[e("el-container",[e("el-aside",{attrs:{width:"200px"}},[e("el-form",{ref:"form"},[t._v("\n        Create a new room\n        "),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("Create")])],1)],1)],1),t._v(" "),e("el-main",t._l(t.all_rooms,function(o){return e("el-col",{key:o},[e("el-button",{attrs:{type:"primary",disabled:-1===t.my_rooms.indexOf(o)},on:{click:function(e){t.enter(o)}}},[t._v(t._s(o))]),t._v(" "),-1!==t.my_rooms.indexOf(o)?e("el-button",{attrs:{type:"danger",round:""},on:{click:function(e){t.leave(o)}}},[t._v("Leave Room")]):e("el-button",{attrs:{type:"success",round:""},on:{click:function(e){t.join(o)}}},[t._v("Join Room")])],1)}))],1)],1)},T=[],V={render:N,staticRenderFns:T},H=V,z=e("VU/8"),A=n,D=z(L,H,!1,A,null,null),J=D.exports;a.default.use(p.a),a.default.use(_.a);var P=new _.a({mode:"history",routes:[{path:"/",name:"HelloWorld",component:I,beforeEnter:function(t,o,e){localStorage.getItem("userid")?e("/rooms"):e()}},{path:"/chat",name:"ChatPanel",component:F,beforeEnter:function(t,o,e){localStorage.getItem("userid")||e("/"),localStorage.getItem("current_room")?e():e("/rooms")}},{path:"/rooms",name:J,component:J,beforeEnter:function(t,o,e){localStorage.getItem("userid")?e():e("/")}}]}),W=e("zL8q"),B=e.n(W),G=(e("tvR6"),e("wUZ8")),M=e.n(G);a.default.config.productionTip=!1,a.default.use(B.a,{locale:M.a}),new a.default({el:"#app",router:P,template:"<App/>",components:{App:f}})},Tk4b:function(t,o){},tvR6:function(t,o){}},["NHnr"]);
//# sourceMappingURL=app.09744c8ad3e21bb53e80.js.map